{% extends 'users/main.html' %} {% block head %}
<script
  type="text/javascript"
  src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js"
  charset="utf-8"
></script>
<script
  type="text/javascript"
  src="http://code.jquery.com/jquery-1.11.3.min.js"
></script>
{% endblock head %} {% block content %}
<div>{% csrf_token %}</div>
<script type="text/javascript">
  let accsTK = "";
  var naver_id_login = new naver_id_login(
    "p3ty5OZcY15ufMgrfHPe",
    "http://127.0.0.1:8000/login/naver_login/callback/"
  );
  // 접근 토큰 값 출력
  accsTK = naver_id_login.oauthParams.access_token;
  localStorage.setItem("accsTK", accsTK);
  // 네이버 사용자 프로필 조회
  naver_id_login.get_naver_userprofile("naverSignInCallback()");
  // 네이버 사용자 프로필 조회 이후 프로필 정보를 처리할 callback function
  function naverSignInCallback() {
    const name = naver_id_login.getProfileData("name");
    const nickname = naver_id_login.getProfileData("nickname");

    const csrf_token = document.querySelector(
      "[name=csrfmiddlewaretoken]"
    ).value;
    fetch("http://127.0.0.1:8000/login/", {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrf_token,
      },
      body: JSON.stringify({ name: name, nickname: nickname }),
    })
      .then((response) => console.log("fetch 성공"))
      .catch((error) => {
        console.error("Fetch error:", error);
      });
  }

  // 로그아웃 버튼 클릭시 로그아웃
</script>
{% endblock %}
